<script>
    /* I, Alanna Mellor, am the author of this code. The following is a simple html page intended to display products for sale. Data for each product is generated from a products_data.json file. The data is passed through a server and output here. */
</script>


<!DOCTYPE html>
<html lang="en">
<html>
<script>
    let params = (new URL(document.location)).searchParams;

    // errors from server has been input into the query string and assigned to the variable "errors_array". if errors_arrays is in the query string, get it, pull out the value, and display it in purchase button
    // store in function and call it when the page loads 
    window.onload = function () {
        for (let i in products) {

            // loop through the products object, pull the quantities entered from query string and put them back in the textboxes
            quantity_form[`quantities${i}`].value = params.get(`quantities${i}`);

            // if query string has the array "errors_array" (passed back by via the server), params.get the array, use JSON parse to turn it from a string back into a js object (I learned to do this by RTFM), store this in a variable
            if (params.has(`errors_array`)) {
                var errors = JSON.parse(params.get(`errors_array`));
            }

            // if the variable storing the errors_array exists, assign the value of the button to the errors
            if (errors) {
                document.getElementById('purchase_button').value = errors;
            };
        }
    }
z

</script>



<head>

    <script>//sends a GET request to the server for ./product_data</script>
    <script src="./product_data.js" type="text/javascript"></script>


    <meta charset="utf-8">
    <title>E-Commerce Store of Cards</title>
    <link href="products-style.css" rel="stylesheet">
</head>
<header>
</header>

<body>
    <nav>
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="product_display.html">Products</a></li>
        </ul>
    </nav>
    <h1>Alanna's House of Cards</h1>
    <div>
        <main>
            <form name="quantity_form" action="./invoice.html" method="POST">
                <script>
                    // for loop that generates product data
                    for (i = 0; i < products.length; i++)
                        document.write(`
                <section class="item">
                    <h2 name = "products${i}_name">${products[i].name}</td>
                    </h2> 
                    <p>$${products[i].price}</p>
                    <img src="${products[i].img}" id = "image">
                    <p>Quantity Available: ${products[i].quantityAvailable}</p>
                    <p>Total Sold: ${products[i].total_sold} </p>
                    <p><label for = "quantities${i}" id = "quantities${i}_label">Enter Quantity Desired:</label><p>
                   <p><input type = "text" id = "quantities${i}" name = "quantities${i}"></p>
                </section>
            `);
                </script>

    </div>
    <footer>
        </p><input type="submit" id="purchase_button" value="Click Here to Purchase!"></p>
    </footer>
    </form>
    </main>
</body>

</html>