<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice</title>
    <script>
        // Your products_data.js content here
        let products = [
            {name: "HTC", price: 40.00},
            {name: "Apple", price: 75.00},
            {name: "Nokia", price: 35.00},
            {name: "Samsung", price: 45.00},
            {name: "Blackberry", price: 10.00}
        ];
        let quantities = [4, 1, 9, 5, 7, 12];
    </script>
</head>
<body>
    <script>
        // Your HTML file's script content here
        function isNonNegInt(q, returnErrors = false) {
            let errors = [];
            if(Number(q) !== q) errors.push('Not a number!');
            if(q < 0) errors.push('Negative value!');
            if(parseInt(q) !== q) errors.push('Not an integer!');
            return returnErrors ? errors : (errors.length === 0);
        }

        function generate_item_rows(product_quantities_array) {
            // Initialize variables
            let subtotal = 0;
            let sales_tax = 5.75;
            let shipping;
            let tax;
            let total;

            // Header Row
            let header_row = invoiceTable.insertRow();
            header_row.insertCell().innerHTML = "<b>Item</b>"; 
            header_row.insertCell().innerHTML = "<b>Quantity</b>";
            header_row.insertCell().innerHTML = "<b>Price</b>";
            header_row.insertCell().innerHTML = "<b>Extended Price</b>";

            for(let i in product_quantities_array) {
                let errors = isNonNegInt(product_quantities_array[i]);
                if(product_quantities_array[i] === 0 || !errors) {
                    continue;
                }
                let extended_price = product_quantities_array[i] * products[i].price;  
                let row = invoiceTable.insertRow();
                row.insertCell().innerHTML = products[i].name; 
                row.insertCell().innerHTML = product_quantities_array[i];
                row.insertCell().innerHTML = products[i].price.toFixed(2);
                row.insertCell().innerHTML = extended_price.toFixed(2);

                subtotal += extended_price;
            }

            // Tax, Shipping, and Total Calculations
            tax = subtotal * sales_tax / 100;
            if (subtotal < 50) {
                shipping = 2.00;
            } else if (subtotal >= 50 && subtotal < 100) {
                shipping = 5.00;
            } else {
                shipping = subtotal * .05;
            }
            total = subtotal + tax + shipping;

            // Subtotal Row
            let subtotal_row = invoiceTable.insertRow();
            subtotal_row.insertCell().innerHTML = "Sub-total";
            subtotal_row.insertCell().innerHTML = ""; 
            subtotal_row.insertCell().innerHTML = "";
            subtotal_row.insertCell().innerHTML = subtotal.toFixed(2);

            // Tax Row
            let tax_row = invoiceTable.insertRow();
            tax_row.insertCell().innerHTML = "Tax @ 5.75%";
            tax_row.insertCell().innerHTML = ""; 
            tax_row.insertCell().innerHTML = "";
            tax_row.insertCell().innerHTML = tax.toFixed(2);

            // Shipping Row
            let shipping_row = invoiceTable.insertRow();
            shipping_row.insertCell().innerHTML = "Shipping";
            shipping_row.insertCell().innerHTML = ""; 
            shipping_row.insertCell().innerHTML = "";
            shipping_row.insertCell().innerHTML = shipping.toFixed(2);

            // Grand Total Row
            let total_row = invoiceTable.insertRow();
            total_row.insertCell().innerHTML = "<b>Total</b>";
            total_row.insertCell().innerHTML = ""; 
            total_row.insertCell().innerHTML = "";
            total_row.insertCell().innerHTML = "<b>" + total.toFixed(2) + "</b>";
        }
    </script>

    <table id="invoiceTable" border="1" style="margin-left: auto; margin-right: auto; border-collapse: collapse;"> 
        <script>
            generate_item_rows(quantities);
        </script>
    </table>
</body>
</html>
